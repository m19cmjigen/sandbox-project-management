# システムアーキテクチャ

## 概要

全社プロジェクト進捗可視化プラットフォームは、JiraのチケットデータをPostgreSQLに取り込み、組織横断でプロジェクト遅延状況を可視化するシステムです。

## システム構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                         クライアント                              │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │           React SPA (Vite + TypeScript)                  │   │
│  │                      port: 3000                          │   │
│  │                                                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │   │
│  │  │  Dashboard  │  │  Projects   │  │     Issues      │  │   │
│  │  │   ページ    │  │   ページ    │  │     ページ      │  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────────┘  │   │
│  │  ┌─────────────────────────────────────────────────────┐ │   │
│  │  │          Organizations ページ (管理UI)               │ │   │
│  │  └─────────────────────────────────────────────────────┘ │   │
│  │                                                          │   │
│  │  状態管理: Zustand  |  UI: Material-UI  |  Chart: Recharts │   │
│  └──────────────�────────────────────────────────────────────┘   │
│                           │ HTTP /api/* → :8080 (Viteプロキシ)    │
└───────────────────────────┼──────────────────────────────────────┘
                            │
┌───────────────────────────▼──────────────────────────────────────┐
│                       バックエンド                                │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │           Go REST API (Gin Framework)                     │   │
│  │                    port: 8080                             │   │
│  │                                                          │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │               Router (Gin)                         │  │   │
│  │  │  ┌───────────┐ ┌──────────┐ ┌──────────────────┐  │  │   │
│  │  │  │  /org     │ │  /proj   │ │   /issues        │  │  │   │
│  │  │  │ handlers  │ │ handlers │ │   handlers       │  │  │   │
│  │  │  └───────────┘ └──────────┘ └──────────────────┘  │  │   │
│  │  │  ┌───────────────────────────────────────────────┐ │  │   │
│  │  │  │           /dashboard handlers                 │ │  │   │
│  │  │  └───────────────────────────────────────────────┘ │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  │                         │ sqlx                            │   │
│  └─────────────────────────┼────────────────────────────────┘   │
│                            │                                     │
└────────────────────────────┼─────────────────────────────────────┘
                             │
┌────────────────────────────▼─────────────────────────────────────┐
│                      データベース                                 │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │            PostgreSQL 15 (Docker)                         │   │
│  │                    port: 5432                             │   │
│  │                                                          │   │
│  │  organizations  projects  issues  sync_logs              │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘

                [将来実装]
┌──────────────────────────────────────────────────────────────────┐
│  Batch Worker → Jira Cloud API (定期同期)                        │
└──────────────────────────────────────────────────────────────────┘
```

## バックエンドレイヤー構成

現在のバックエンドはシンプルなハンドラー直結構造になっており、Go Clean Architectureの導入を計画しています。

```
backend/
├── cmd/api/main.go                        # エントリーポイント
└── internal/
    ├── domain/                            # エンティティ・ビジネスルール (予定)
    ├── usecase/                           # アプリケーションロジック (予定)
    ├── interface/                         # HTTPハンドラー・DTO (予定)
    └── infrastructure/
        └── router/
            ├── router.go                  # ルーター定義・ミドルウェア
            ├── dashboard_handlers.go      # ダッシュボードAPI
            ├── organization_handlers.go   # 組織API (参照系)
            ├── project_handlers.go        # プロジェクトAPI
            ├── issue_handlers.go          # チケットAPI
            └── management_handlers.go    # 組織・プロジェクト管理API
```

依存方向: `interface` → `usecase` → `domain` ← `infrastructure`

## フロントエンド構成

```
frontend/src/
├── pages/         # ルートレベルコンポーネント
│   ├── Dashboard.tsx
│   ├── Projects.tsx
│   ├── Issues.tsx
│   └── Organizations.tsx
├── components/    # 再利用可能なUIコンポーネント
│   ├── ProjectCard.tsx
│   ├── OrganizationTree.tsx
│   └── ...
├── stores/        # Zustand ステートストア
├── api/           # Axios APIクライアント (/api/v1 プレフィックス)
└── theme/         # Material-UIカスタムテーマ
```

## 遅延ステータス判定ロジック

チケットの遅延ステータスはDBトリガーで自動計算されます。

| 条件 | ステータス |
|---|---|
| 未完了 かつ 期日 < 今日 | RED (遅延) |
| 未完了 かつ 期日が今日〜3日後 | YELLOW (要注意) |
| 未完了 かつ 期日未設定 | YELLOW (要注意) |
| その他 (完了済みまたは余裕あり) | GREEN (正常) |

プロジェクト・組織のステータスは上記チケットのステータスを集計して決定:
- 1件でもREDチケットがある → RED
- REDなし・1件でもYELLOWがある → YELLOW
- それ以外 → GREEN

## 技術スタック

| レイヤー | 技術 | バージョン |
|---|---|---|
| フロントエンド | React | 18 |
| フロントエンド | TypeScript | 5 |
| フロントエンド | Vite | 5 |
| フロントエンド | Material-UI | 5 |
| フロントエンド | Zustand | 最新 |
| フロントエンド | Recharts | 最新 |
| バックエンド | Go | 1.21 |
| バックエンド | Gin | 最新 |
| バックエンド | sqlx | 最新 |
| バックエンド | Uber Zap | 最新 |
| データベース | PostgreSQL | 15 |
| マイグレーション | golang-migrate | 最新 |
| コンテナ | Docker Compose | 最新 |
| パフォーマンステスト | k6 | 最新 |
| E2Eテスト | Playwright | 最新 |
