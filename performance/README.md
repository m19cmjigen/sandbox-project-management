# パフォーマンステスト

k6を使ったAPIパフォーマンステストスイート。

## 前提条件

```bash
brew install k6   # macOS
# または: https://grafana.com/docs/k6/latest/set-up/install-k6/
```

## テストの種類

| スクリプト | VU数 | 時間 | 目的 |
|---|---|---|---|
| `scripts/smoke.js` | 1 | 30秒 | 全エンドポイントの基本動作確認 |
| `scripts/load.js` | 最大10 | 90秒 | 通常トラフィック下のパフォーマンス確認 |
| `scripts/stress.js` | 最大50 | 160秒 | 限界点・ボトルネックの特定 |

## 実行方法

```bash
# バックエンド起動確認
make up && make db-migrate

# 個別実行
./performance/run.sh smoke
./performance/run.sh load
./performance/run.sh stress

# 全テスト実行
./performance/run.sh all

# 対象サーバーを指定（デフォルト: http://localhost:8080）
BASE_URL=http://staging.example.com ./performance/run.sh load
```

## しきい値

| メトリクス | 目標値 |
|---|---|
| p(95) レスポンスタイム（全体） | < 500ms |
| p(99) レスポンスタイム（負荷テスト） | < 1000ms |
| p(95) レスポンスタイム（ストレステスト） | < 2000ms |
| エラー率 | < 1% |

## テスト結果（2026-02-23 実測値）

バックエンド環境: Go + PostgreSQL (Docker)、データ: シードデータ（約10プロジェクト・70チケット）

### スモークテスト（1 VU / 30秒）

| エンドポイント | avg | p(95) | 目標 |
|---|---|---|---|
| GET /dashboard/summary | 10.06ms | 15.37ms | < 500ms ✓ |
| GET /organizations | 7.61ms | 9.75ms | < 300ms ✓ |
| GET /projects | 7.91ms | 10.91ms | < 500ms ✓ |
| GET /issues | 8.52ms | 11.67ms | < 500ms ✓ |
| 全体 | 8.94ms | 16.10ms | < 500ms ✓ |

- チェック成功: 100/100 (100%)
- エラー率: 0.00% ✓

### 負荷テスト（最大10 VU / 90秒）

| メトリクス | 結果 | 目標 |
|---|---|---|
| p(95) レスポンスタイム | 13.11ms | < 500ms ✓ |
| p(99) レスポンスタイム | 16.11ms | < 1000ms ✓ |
| エラー率 | 0.00% | < 1% ✓ |
| スループット | 4.2 req/s | — |
| チェック成功 | 375/375 (100%) | — |

### ストレステスト（最大50 VU / 160秒）

| メトリクス | 結果 | 目標 |
|---|---|---|
| p(95) レスポンスタイム | 18.54ms | < 2000ms ✓ |
| 最大レスポンスタイム | 75.55ms | — |
| エラー率 | 0.00% | < 10% ✓ |
| ピークスループット | ~40 req/s (50 VU) | — |
| チェック成功 | 12,776/12,776 (100%) | — |

## 評価

**全非機能要件を達成。**

- 50同時接続でもp(95)が18.54ms（目標2000ms）と大幅に余裕あり
- エラーゼロで安定動作
- ローカル環境での実測のため、本番（Aurora + Fargate）では追加テストを推奨

## 注意事項

- テスト実行には約4分かかります（`all` モード）
- ストレステスト中はデータベースへの接続が増加します
- 結果は `performance/results/` に保存されます（.gitignore対象）
